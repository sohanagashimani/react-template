// import React, { useState, useEffect, useCallback, useMemo, useRef } from "react"; import { FaSearch } from "react-icons/fa"; import { useNavigate } from "react-router-dom"; import "./SearchBar.css"; import { generateBaseURL } from "../utils.js"; import useDebounce from "../hooks/useDebounce"; function SearchBar() { const [searchText, setSearchText] = useState(""); const [showResults, setShowResults] = useState(false); const [searchResults, setSearchResults] = useState([]); const navigate = useNavigate(); const [isDropdownOpen, setIsDropdownOpen] = useState(false); const debouncedSearchText = useDebounce(searchText, 10); const dropdownRef = useRef(null); useEffect(() => { function handleClickOutside(event) { if (dropdownRef.current && !dropdownRef.current.contains(event.target)) { setIsDropdownOpen(false) setShowResults(false) setSearchText("") } } document.addEventListener("mousedown", handleClickOutside); return () => document.removeEventListener("mousedown", handleClickOutside); }, []); const fetchSearchResults = useCallback(async (value) => { if (value.length > 0) { try { const baseURL = generateBaseURL(); const response = await fetch( ${baseURL}/api/apartments/search?location=${value} ); if (!response.ok) { throw new Error("Network response was not ok"); } const data = await response.json(); setSearchResults(data); } catch (error) { console.error("Error retrieving search results:", error); } } else { setSearchResults([]); } }, []); useEffect(() => { fetchSearchResults(debouncedSearchText); }, [debouncedSearchText]); const handleInputChange = (event) => { const { value } = event.target; setSearchText(value); setShowResults(value.length > 0); setIsDropdownOpen(true); fetchSearchResults(value); }; const handleApartmentClick = (apartmentId) => { navigate(/apartments/detail/${apartmentId}); setIsDropdownOpen(false); setShowResults(false); setSearchText(""); }; const memoizedSearchResults = useMemo(() => { return searchResults.length > 0 ? ( searchResults.map((result) => ( <p key={result._id} onClick={() => handleApartmentClick(result._id)} > {result.address} </p> )) ) : ( <p className="no-results">No matching results found</p> ); }, [searchResults, handleApartmentClick]); return ( <div className="search-bar"> <input data-testid="search-input" type="text" className="search-input" placeholder="Search for a location" value={searchText} onChange={handleInputChange} /> <button className="search-button" onClick={() => fetchSearchResults(searchText)}> <FaSearch /> </button> {isDropdownOpen && showResults && ( <div ref={dropdownRef} data-testid="search-div" className="results-dropdown" > {memoizedSearchResults} </div> )} </div> ); } export default SearchBar;
